## 10.Spring6新特性之多线程异步创建非懒加载单例Bean

在Spring6中，支持在Spring容器启动过程中，通过线程池来进行异步创建非懒加载的单例Bean。
默认是没有开启的，也就是默认都是main线程来创建所有的非懒加载的单例Bean，要启用该功能，首先需要定义一个专门用来创建Bean的线程池：

```java
@Bean
public Executor bootstrapExecutor() {
	return Executors.newFixedThreadPool(5);
}
```

注意，名字一定要叫bootstrapExecutor。

然后配置需要进行异步创建的Bean:

```java
@Bean(bootstrap = Bean.Bootstrap.BACKGROUND)
public UserService userService(){
	System.out.println(Thread.currentThread().getName());
	return new UserService();
}
```

如果想要批量给多个Bean进行配置，那么可以：

```java
@Component
public class WYYBeanFactoryPostProcessor implements BeanFactoryPostProcessor {
	@Override
	public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException {
		String[] beanDefinitionNames = beanFactory.getBeanDefinitionNames();
		for(String beanName:beanDefinitionNames){
			BeanDefinition beanDefinition = beanFactory.getBeanDefinition(beanName);
			if(beanDefinition instanceof AbstractBeanDefinition abstractBeanDefinition){
				abstractBeanDefinition.setBackgroundInit(true);
			}
		}

	}
}
```

多线程创建bean存在一个错误，

线程1:userService-->创建UserService->依赖注入-->创建0rderService 10s

线程2：orderSerice-->等了3s--->创建orderService 发现orderService正在创建中，它会自己等自己有问题

